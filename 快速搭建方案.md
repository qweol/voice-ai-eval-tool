# TTS/ASR 对比工具 - 快速搭建方案

## 一、极简技术栈

### 前端
- **Next.js 14** (React框架，自带路由和API)
- **Tailwind CSS** (快速样式)
- **shadcn/ui** (现成组件)

### 后端
- **Next.js API Routes** (无需单独后端)
- **本地文件存储** (无需数据库)

### 配置
- **.env 文件** (存储API密钥)

## 二、项目结构（极简）

```
voice-ai-eval-tool/
├── app/
│   ├── page.tsx              # 首页（导航）
│   ├── asr/
│   │   └── page.tsx          # ASR对比页面
│   ├── tts/
│   │   └── page.tsx          # TTS对比页面
│   └── api/
│       ├── asr/
│       │   └── route.ts      # ASR API
│       └── tts/
│           └── route.ts      # TTS API
├── lib/
│   ├── providers/
│   │   ├── aliyun.ts         # 阿里云适配器
│   │   ├── tencent.ts        # 腾讯云适配器
│   │   └── baidu.ts          # 百度适配器
│   └── utils.ts              # 工具函数
├── public/
│   └── audio/                # 生成的音频文件
├── .env.local                # API密钥配置
├── package.json
└── next.config.js
```

## 三、快速开始

### 1. 初始化项目（5分钟）

```bash
# 创建 Next.js 项目
npx create-next-app@latest voice-ai-eval-tool --typescript --tailwind --app

cd voice-ai-eval-tool

# 安装必要依赖
npm install axios form-data
npm install @alicloud/asr-client @alicloud/tts-client  # 阿里云SDK
npm install tencentcloud-sdk-nodejs                     # 腾讯云SDK
npm install baidu-aip                                   # 百度SDK
```

### 2. 配置环境变量（2分钟）

创建 `.env.local`:
```bash
# 阿里云
ALIYUN_ACCESS_KEY_ID=your_key
ALIYUN_ACCESS_KEY_SECRET=your_secret

# 腾讯云
TENCENT_SECRET_ID=your_id
TENCENT_SECRET_KEY=your_key

# 百度
BAIDU_API_KEY=your_key
BAIDU_SECRET_KEY=your_secret
```

### 3. 核心代码实现

#### ASR 对比页面 (`app/asr/page.tsx`)

```tsx
'use client';

import { useState } from 'react';

export default function ASRPage() {
  const [file, setFile] = useState<File | null>(null);
  const [results, setResults] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  const handleCompare = async () => {
    if (!file) return;

    setLoading(true);
    const formData = new FormData();
    formData.append('file', file);

    const res = await fetch('/api/asr', {
      method: 'POST',
      body: formData,
    });

    const data = await res.json();
    setResults(data.results);
    setLoading(false);
  };

  return (
    <div className="container mx-auto p-8">
      <h1 className="text-3xl font-bold mb-8">ASR 语音识别对比</h1>

      {/* 文件上传 */}
      <div className="mb-8">
        <input
          type="file"
          accept="audio/*"
          onChange={(e) => setFile(e.target.files?.[0] || null)}
          className="border p-2 rounded"
        />
        <button
          onClick={handleCompare}
          disabled={!file || loading}
          className="ml-4 bg-blue-500 text-white px-6 py-2 rounded disabled:bg-gray-300"
        >
          {loading ? '识别中...' : '开始识别'}
        </button>
      </div>

      {/* 结果展示 */}
      {results.length > 0 && (
        <table className="w-full border-collapse border">
          <thead>
            <tr className="bg-gray-100">
              <th className="border p-2">供应商</th>
              <th className="border p-2">识别文本</th>
              <th className="border p-2">耗时(秒)</th>
              <th className="border p-2">状态</th>
            </tr>
          </thead>
          <tbody>
            {results.map((result, i) => (
              <tr key={i}>
                <td className="border p-2">{result.provider}</td>
                <td className="border p-2">{result.text}</td>
                <td className="border p-2">{result.duration}</td>
                <td className="border p-2">
                  {result.status === 'success' ? '✅' : '❌'}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      )}
    </div>
  );
}
```

#### ASR API (`app/api/asr/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { recognizeWithAliyun } from '@/lib/providers/aliyun';
import { recognizeWithTencent } from '@/lib/providers/tencent';
import { recognizeWithBaidu } from '@/lib/providers/baidu';

export async function POST(request: NextRequest) {
  const formData = await request.formData();
  const file = formData.get('file') as File;

  if (!file) {
    return NextResponse.json({ error: 'No file' }, { status: 400 });
  }

  const buffer = Buffer.from(await file.arrayBuffer());

  // 并发调用所有供应商
  const results = await Promise.allSettled([
    recognizeWithAliyun(buffer),
    recognizeWithTencent(buffer),
    recognizeWithBaidu(buffer),
  ]);

  const formattedResults = results.map((result, index) => {
    const providers = ['阿里云', '腾讯云', '百度'];

    if (result.status === 'fulfilled') {
      return {
        provider: providers[index],
        text: result.value.text,
        duration: result.value.duration,
        status: 'success',
      };
    } else {
      return {
        provider: providers[index],
        text: result.reason.message,
        duration: 0,
        status: 'failed',
      };
    }
  });

  return NextResponse.json({ results: formattedResults });
}
```

#### TTS 对比页面 (`app/tts/page.tsx`)

```tsx
'use client';

import { useState } from 'react';

export default function TTSPage() {
  const [text, setText] = useState('');
  const [results, setResults] = useState<any[]>([]);
  const [loading, setLoading] = useState(false);

  const handleCompare = async () => {
    if (!text) return;

    setLoading(true);
    const res = await fetch('/api/tts', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text }),
    });

    const data = await res.json();
    setResults(data.results);
    setLoading(false);
  };

  return (
    <div className="container mx-auto p-8">
      <h1 className="text-3xl font-bold mb-8">TTS 语音合成对比</h1>

      {/* 文本输入 */}
      <div className="mb-8">
        <textarea
          value={text}
          onChange={(e) => setText(e.target.value)}
          placeholder="输入要合成的文本..."
          className="w-full border p-4 rounded h-32"
        />
        <button
          onClick={handleCompare}
          disabled={!text || loading}
          className="mt-4 bg-blue-500 text-white px-6 py-2 rounded disabled:bg-gray-300"
        >
          {loading ? '合成中...' : '开始合成'}
        </button>
      </div>

      {/* 结果展示 */}
      {results.length > 0 && (
        <div className="space-y-4">
          {results.map((result, i) => (
            <div key={i} className="border p-4 rounded">
              <div className="flex items-center justify-between">
                <h3 className="font-bold">{result.provider}</h3>
                <span className="text-sm text-gray-500">
                  耗时: {result.duration}s
                </span>
              </div>
              {result.status === 'success' ? (
                <audio controls src={result.audioUrl} className="w-full mt-2" />
              ) : (
                <p className="text-red-500 mt-2">❌ {result.error}</p>
              )}
            </div>
          ))}
        </div>
      )}
    </div>
  );
}
```

#### TTS API (`app/api/tts/route.ts`)

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { synthesizeWithAliyun } from '@/lib/providers/aliyun';
import { synthesizeWithTencent } from '@/lib/providers/tencent';
import { synthesizeWithBaidu } from '@/lib/providers/baidu';
import { writeFile } from 'fs/promises';
import path from 'path';

export async function POST(request: NextRequest) {
  const { text } = await request.json();

  if (!text) {
    return NextResponse.json({ error: 'No text' }, { status: 400 });
  }

  // 并发调用所有供应商
  const results = await Promise.allSettled([
    synthesizeWithAliyun(text),
    synthesizeWithTencent(text),
    synthesizeWithBaidu(text),
  ]);

  const formattedResults = await Promise.all(
    results.map(async (result, index) => {
      const providers = ['aliyun', 'tencent', 'baidu'];
      const providerNames = ['阿里云', '腾讯云', '百度'];

      if (result.status === 'fulfilled') {
        // 保存音频文件
        const filename = `${providers[index]}_${Date.now()}.mp3`;
        const filepath = path.join(process.cwd(), 'public', 'audio', filename);
        await writeFile(filepath, result.value.audioBuffer);

        return {
          provider: providerNames[index],
          audioUrl: `/audio/${filename}`,
          duration: result.value.duration,
          status: 'success',
        };
      } else {
        return {
          provider: providerNames[index],
          error: result.reason.message,
          duration: 0,
          status: 'failed',
        };
      }
    })
  );

  return NextResponse.json({ results: formattedResults });
}
```

#### 供应商适配器示例 (`lib/providers/aliyun.ts`)

```typescript
// 这里是简化示例，实际需要根据各供应商SDK文档实现

export async function recognizeWithAliyun(audioBuffer: Buffer) {
  const startTime = Date.now();

  // TODO: 调用阿里云ASR API
  // const client = new AliyunASRClient({
  //   accessKeyId: process.env.ALIYUN_ACCESS_KEY_ID,
  //   accessKeySecret: process.env.ALIYUN_ACCESS_KEY_SECRET,
  // });
  // const result = await client.recognize(audioBuffer);

  const duration = (Date.now() - startTime) / 1000;

  return {
    text: '识别结果文本',  // 实际从API返回
    duration,
  };
}

export async function synthesizeWithAliyun(text: string) {
  const startTime = Date.now();

  // TODO: 调用阿里云TTS API
  // const client = new AliyunTTSClient({...});
  // const audioBuffer = await client.synthesize(text);

  const duration = (Date.now() - startTime) / 1000;

  return {
    audioBuffer: Buffer.from([]),  // 实际从API返回
    duration,
  };
}
```

### 4. 首页导航 (`app/page.tsx`)

```tsx
import Link from 'next/link';

export default function Home() {
  return (
    <div className="container mx-auto p-8">
      <h1 className="text-4xl font-bold mb-8">语音服务对比工具</h1>

      <div className="grid grid-cols-2 gap-8">
        <Link href="/asr">
          <div className="border p-8 rounded-lg hover:shadow-lg cursor-pointer">
            <h2 className="text-2xl font-bold mb-4">ASR 语音识别</h2>
            <p className="text-gray-600">上传音频文件，对比多个供应商的识别效果</p>
          </div>
        </Link>

        <Link href="/tts">
          <div className="border p-8 rounded-lg hover:shadow-lg cursor-pointer">
            <h2 className="text-2xl font-bold mb-4">TTS 语音合成</h2>
            <p className="text-gray-600">输入文本，对比多个供应商的合成效果</p>
          </div>
        </Link>
      </div>
    </div>
  );
}
```

## 四、启动项目

```bash
# 创建音频存储目录
mkdir -p public/audio

# 启动开发服务器
npm run dev

# 访问 http://localhost:3000
```

## 五、核心优势

✅ **无需数据库** - 所有数据临时处理
✅ **无需单独后端** - Next.js API Routes 搞定
✅ **快速部署** - 一个命令 `npm run build && npm start`
✅ **代码量少** - 核心功能不到 500 行代码

## 六、后续优化（可选）

如果需要更多功能，可以逐步添加：

1. **配置页面** - 通过界面修改 API 密钥
2. **历史记录** - 添加 SQLite 存储对比历史
3. **差异高亮** - 使用 `diff` 库高亮文本差异
4. **批量测试** - 支持上传多个文件
5. **导出报告** - 生成 Excel 或 PDF 报告

## 七、部署

### Vercel 部署（最简单）
```bash
npm install -g vercel
vercel
```

### Docker 部署
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "start"]
```

```bash
docker build -t voice-ai-eval .
docker run -p 3000:3000 --env-file .env.local voice-ai-eval
```

---

## 总结

这个方案可以在 **1-2 小时内** 搭建起核心功能：
- ✅ ASR 对比
- ✅ TTS 对比
- ✅ 并发调用
- ✅ 结果展示

关键是先跑起来，后续再根据需求迭代优化！
