# 功能说明文档

## 新增功能概览

本次更新将工具从简单的对比工具升级为功能完善的第三方服务调试平台，主要新增以下功能：

### 1. 设置页面 (`/settings`)

**功能特点：**
- ✅ 支持手动配置各供应商的API密钥
- ✅ 支持启用/禁用特定供应商
- ✅ 配置TTS默认参数（音色、语速、音量、音调）
- ✅ 配置ASR默认参数（语言、格式）
- ✅ 配置存储在浏览器本地（localStorage），不会上传到服务器
- ✅ 支持重置为默认值

**安全提示：**
- API密钥仅存储在浏览器本地
- 清除浏览器数据会删除所有配置
- 建议妥善保管API密钥

### 2. TTS页面增强 (`/tts`)

**新增功能：**

#### 2.1 音色选择
- 每个供应商可以独立选择音色
- 支持音色类型：
  - 标准音色（standard）
  - 精品音色（premium）
  - 大模型音色（large-model）

#### 2.2 参数调整
- **语速调节**：0.5x - 2.0x（滑块控制）
- **音量调节**：0 - 1.0（滑块控制）
- **音调调节**：0 - 2.0（滑块控制）
- 实时显示当前参数值

#### 2.3 供应商选择
- 可以选择启用/禁用特定供应商
- 只对启用的供应商进行对比测试
- 未配置API密钥的供应商会自动禁用

#### 2.4 智能提示
- 如果未配置任何供应商，会提示用户前往设置页面
- 显示已启用的供应商数量

### 3. ASR页面增强 (`/asr`)

**新增功能：**

#### 3.1 识别参数配置
- **语言选择**：中文、英文、中英文混合
- **音频格式**：WAV、MP3、M4A

#### 3.2 供应商选择
- 可以选择启用/禁用特定供应商
- 只对启用的供应商进行对比测试
- 未配置API密钥的供应商会自动禁用

#### 3.3 结果展示增强
- 新增置信度显示（如果供应商返回）
- 更清晰的结果对比表格
- 显示识别耗时和状态

### 4. 配置管理系统

**核心功能：**
- 使用 `localStorage` 存储用户配置
- 配置包括：
  - 各供应商的API密钥
  - 供应商启用状态
  - TTS/ASR默认参数
- 提供配置读取、保存、重置API

**配置文件位置：**
- `lib/utils/config.ts` - 配置管理工具

## 使用流程

### 首次使用

1. **配置API密钥**
   - 访问 `/settings` 页面
   - 填写各供应商的API密钥
   - 启用需要测试的供应商
   - 点击"保存配置"

2. **测试TTS**
   - 访问 `/tts` 页面
   - 输入测试文本
   - 选择音色和调整参数
   - 选择要对比的供应商
   - 点击"开始合成"

3. **测试ASR**
   - 访问 `/asr` 页面
   - 上传音频文件
   - 选择语言和格式
   - 选择要对比的供应商
   - 点击"开始识别"

### 日常使用

- 配置会自动保存，下次访问时自动加载
- 可以在设置页面随时修改配置
- 每个测试页面都可以临时调整参数

## 技术实现

### 配置存储

```typescript
// 配置结构
interface AppConfig {
  providers: {
    aliyun: { enabled: boolean; apiKey?: string; apiSecret?: string };
    tencent: { enabled: boolean; secretId?: string; secretKey?: string };
    baidu: { enabled: boolean; apiKey?: string; apiSecret?: string };
  };
  tts: { defaultVoice: string; defaultSpeed: number; ... };
  asr: { defaultLanguage: string; defaultFormat: string };
}
```

### API密钥传递

- 前端从 `localStorage` 读取配置
- 通过请求体传递给后端API
- 后端临时设置环境变量后调用供应商函数
- 调用完成后恢复原始环境变量

### 供应商适配

- 支持动态启用/禁用供应商
- 支持为每个供应商单独配置参数
- 支持从请求中读取API密钥（覆盖环境变量）

## 安全考虑

### 当前实现
- ✅ API密钥存储在浏览器本地（localStorage）
- ✅ 密钥通过HTTPS传输（生产环境）
- ✅ 密钥不会永久存储在服务器

### 建议改进（未来）
- [ ] 支持加密存储API密钥
- [ ] 支持密钥过期时间设置
- [ ] 支持密钥使用统计
- [ ] 支持多用户/多项目配置

## 界面改进

### 首页
- 新增设置入口卡片
- 更清晰的导航结构

### TTS页面
- 参数调整区域（滑块控制）
- 供应商和音色选择区域
- 更清晰的结果展示

### ASR页面
- 识别参数配置区域
- 供应商选择区域
- 增强的结果表格（包含置信度）

### 设置页面
- 分组展示配置项
- 实时保存提示
- 安全提示信息

## 后续优化建议

### 功能增强
- [ ] 支持批量测试（多个文本/音频）
- [ ] 支持历史记录查看
- [ ] 支持导出对比报告
- [ ] 支持音频波形可视化
- [ ] 支持文本差异高亮

### 用户体验
- [ ] 添加配置导入/导出功能
- [ ] 添加配置模板（预设场景）
- [ ] 添加使用统计和成本估算
- [ ] 添加错误重试机制

### 技术优化
- [ ] 支持配置同步（多设备）
- [ ] 支持配置加密存储
- [ ] 优化大文件上传体验
- [ ] 添加请求缓存机制

## 总结

本次更新将工具从简单的对比工具升级为功能完善的调试平台，主要改进包括：

1. **配置管理**：支持前端配置API密钥，无需修改环境变量
2. **参数控制**：支持精细调整TTS/ASR参数
3. **供应商选择**：支持灵活选择要对比的供应商
4. **用户体验**：更直观的界面，更清晰的操作流程

这些改进使得工具更适合作为日常的第三方服务调试和评估平台使用。
